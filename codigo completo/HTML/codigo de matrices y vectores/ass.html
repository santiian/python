<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Avanzada de Matrices y Vectores</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    <style>
        /* Estilos CSS (se mantienen igual que en el c√≥digo original) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            animation: fadeInUp 1s ease-out 0.2s both;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .section {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 2.5rem;
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid rgba(103, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .input-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: rgba(103, 126, 234, 0.4);
        }

        .input-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-fill {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 5px 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }

        .dimension-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .dimension-controls label {
            font-weight: 600;
            color: #555;
        }

        .dimension-input {
            width: 60px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .matrix-grid, .vector-grid {
            display: grid;
            gap: 8px;
            margin-top: 15px;
        }

        .matrix-input, .vector-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .matrix-input:focus, .vector-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
            transform: scale(1.02);
        }

        .operations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .operation-btn {
            padding: 15px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .operation-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .operation-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .operation-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .operation-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .operation-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .result-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 100px;
            margin-bottom: 20px;
        }

        .result-content {
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
        }

        .result-title {
            font-size: 1.3rem;
            color: #667eea;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .matrix-display, .vector-display {
            font-family: 'Courier New', monospace;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid #e0e0e0;
            overflow-x: auto;
        }

        .empty-result {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .procedure-container {
            width: 100%;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .procedure-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .procedure-steps {
            font-size: 1rem;
            color: #555;
            line-height: 1.6;
        }

        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success-message {
            background: #efe;
            border: 1px solid #cfc;
            color: #3c3;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .steps-visualization {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .formula {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
            }

            .operations-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-nav {
                flex-direction: column;
                align-items: center;
            }

            .dimension-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ Calculadora Avanzada</h1>
            <p>Matrices y Vectores - Herramienta Matem√°tica Completa</p>
        </div>

        <nav class="main-nav">
            <button class="nav-btn active" onclick="showSection('matrices')">üî¢ Matrices</button>
            <button class="nav-btn" onclick="showSection('vectors')">‚û°Ô∏è Vectores</button>
            <button class="nav-btn" onclick="showSection('equation-systems')">‚ûó Sistemas</button>
            <button class="nav-btn" onclick="showSection('calculator')">üß™ Calculadora</button>
        </nav>

        <!-- Secci√≥n de Matrices -->
        <div id="matrices" class="section active">
            <h2 class="section-title">Operaciones con Matrices</h2>

            <div class="input-grid">
                <div class="input-card">
                    <h3>üìä Matriz A</h3>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="fillMatrix('matrix-a', 'identity')">Identidad</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-a', 'zeros')">Ceros</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-a', 'ones')">Unos</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-a', 'random')">Aleatorio</button>
                        <button class="quick-btn" onclick="clearMatrix('matrix-a')">Limpiar</button>
                    </div>
                    <div class="dimension-controls">
                        <label>Filas:</label>
                        <input type="number" class="dimension-input" id="matrix-a-rows" value="3" min="1" max="6" onchange="generateMatrixInputs('matrix-a', this.value, document.getElementById('matrix-a-cols').value)">
                        <label>Columnas:</label>
                        <input type="number" class="dimension-input" id="matrix-a-cols" value="3" min="1" max="6" onchange="generateMatrixInputs('matrix-a', document.getElementById('matrix-a-rows').value, this.value)">
                    </div>
                    <div id="matrix-a-inputs" class="matrix-grid"></div>
                </div>

                <div class="input-card">
                    <h3>üìä Matriz B</h3>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="fillMatrix('matrix-b', 'identity')">Identidad</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-b', 'zeros')">Ceros</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-b', 'ones')">Unos</button>
                        <button class="quick-btn" onclick="fillMatrix('matrix-b', 'random')">Aleatorio</button>
                        <button class="quick-btn" onclick="clearMatrix('matrix-b')">Limpiar</button>
                    </div>
                    <div class="dimension-controls">
                        <label>Filas:</label>
                        <input type="number" class="dimension-input" id="matrix-b-rows" value="3" min="1" max="6" onchange="generateMatrixInputs('matrix-b', this.value, document.getElementById('matrix-b-cols').value)">
                        <label>Columnas:</label>
                        <input type="number" class="dimension-input" id="matrix-b-cols" value="3" min="1" max="6" onchange="generateMatrixInputs('matrix-b', document.getElementById('matrix-b-rows').value, this.value)">
                    </div>
                    <div id="matrix-b-inputs" class="matrix-grid"></div>
                </div>
            </div>

            <div class="operations-grid">
                <button class="operation-btn" onclick="addMatrices()">‚ûï Suma A + B</button>
                <button class="operation-btn" onclick="subtractMatrices()">‚ûñ Resta A - B</button>
                <button class="operation-btn" onclick="multiplyMatrices()">‚úñÔ∏è Multiplicaci√≥n A √ó B</button>
                <button class="operation-btn" onclick="transposeMatrix()">üîÑ Transpuesta A</button>
                <button class="operation-btn" onclick="determinantMatrix()">üéØ Determinante A</button>
                <button class="operation-btn" onclick="scalarMultiply()">üìà Escalar √ó A</button>
                <button class="operation-btn" onclick="matrixPower()">‚ö° Potencia A^n</button>
                <button class="operation-btn" onclick="inverseMatrix()">üîÑ Inversa A</button>
                <button class="operation-btn" onclick="rankMatrix()">üìè Rango A</button>
                <button class="operation-btn" onclick="traceMatrix()">üìê Traza A</button>
                <button class="operation-btn" onclick="eigenvaluesMatrix()">üé≤ Eigenvalores A</button>
                <button class="operation-btn" onclick="luDecomposition()">üìä Descomposici√≥n LU</button>
                <button class="operation-btn" onclick="determinantAx()">üéØ Determinante Ax</button>
                <button class="operation-btn" onclick="determinantAy()">üéØ Determinante Ay</button>
                <button class="operation-btn" onclick="determinantAz()">üéØ Determinante Az</button>
            </div>

            <div class="result-card">
                <div id="matrix-result" class="result-content">
                    <div class="empty-result">Los resultados aparecer√°n aqu√≠...</div>
                </div>
            </div>

            <div class="procedure-container">
                <div id="matrix-procedure"></div>
            </div>
        </div>

        <!-- Secci√≥n de Vectores -->
        <div id="vectors" class="section">
            <h2 class="section-title">Operaciones con Vectores</h2>

            <div class="input-grid">
                <div class="input-card">
                    <h3>‚û°Ô∏è Vector A</h3>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="fillVector('vector-a', 'zeros')">Ceros</button>
                        <button class="quick-btn" onclick="fillVector('vector-a', 'ones')">Unos</button>
                        <button class="quick-btn" onclick="fillVector('vector-a', 'random')">Aleatorio</button>
                        <button class="quick-btn" onclick="fillVector('vector-a', 'unit')">Unitario</button>
                        <button class="quick-btn" onclick="clearVector('vector-a')">Limpiar</button>
                    </div>
                    <div class="dimension-controls">
                        <label>Dimensi√≥n:</label>
                        <input type="number" class="dimension-input" id="vector-a-dim" value="3" min="2" max="6" onchange="generateVectorInputs('vector-a', this.value)">
                    </div>
                    <div id="vector-a-inputs" class="vector-grid"></div>
                </div>

                <div class="input-card">
                    <h3>‚û°Ô∏è Vector B</h3>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="fillVector('vector-b', 'zeros')">Ceros</button>
                        <button class="quick-btn" onclick="fillVector('vector-b', 'ones')">Unos</button>
                        <button class="quick-btn" onclick="fillVector('vector-b', 'random')">Aleatorio</button>
                        <button class="quick-btn" onclick="fillVector('vector-b', 'unit')">Unitario</button>
                        <button class="quick-btn" onclick="clearVector('vector-b')">Limpiar</button>
                    </div>
                    <div class="dimension-controls">
                        <label>Dimensi√≥n:</label>
                        <input type="number" class="dimension-input" id="vector-b-dim" value="3" min="2" max="6" onchange="generateVectorInputs('vector-b', this.value)">
                    </div>
                    <div id="vector-b-inputs" class="vector-grid"></div>
                </div>
            </div>

            <div class="operations-grid">
                <button class="operation-btn" onclick="addVectors()">‚ûï Suma A + B</button>
                <button class="operation-btn" onclick="subtractVectors()">‚ûñ Resta A - B</button>
                <button class="operation-btn" onclick="dotProduct()">‚ö´ Producto Escalar</button>
                <button class="operation-btn" onclick="crossProduct()">‚úñÔ∏è Producto Vectorial</button>
                <button class="operation-btn" onclick="vectorMagnitude()">üìè Magnitud A</button>
                <button class="operation-btn" onclick="vectorAngle()">üìê √Ångulo A, B</button>
                <button class="operation-btn" onclick="normalizeVector()">üìê Normalizar A</button>
                <button class="operation-btn" onclick="projectVector()">üìç Proyecci√≥n A‚ÜíB</button>
                <button class="operation-btn" onclick="distanceBetweenVectors()">üìè Distancia A‚ÜîB</button>
                <button class="operation-btn" onclick="vectorTripleProduct()">üî∫ Producto Triple</button>
                <button class="operation-btn" onclick="scalarTripleProduct()">üî∫ Triple Escalar</button>
                <button class="operation-btn" onclick="vectorPerpendicular()">‚üÇ Perpendicular A</button>
            </div>

            <div class="result-card">
                <div id="vector-result" class="result-content">
                    <div class="empty-result">Los resultados aparecer√°n aqu√≠...</div>
                </div>
            </div>

            <div class="procedure-container">
                <div id="vector-procedure"></div>
            </div>
        </div>

        <!-- Secci√≥n de Sistemas de Ecuaciones -->
        <div id="equation-systems" class="section">
            <h2 class="section-title">Sistemas de Ecuaciones Lineales</h2>

            <div class="input-grid">
                <div class="input-card">
                    <h3>üìù Matriz de Coeficientes</h3>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="fillEquationMatrix('random')">Aleatorio</button>
                        <button class="quick-btn" onclick="fillEquationMatrix('example')">Ejemplo</button>
                        <button class="quick-btn" onclick="clearEquationMatrix()">Limpiar</button>
                    </div>
                    <div class="dimension-controls">
                        <label>Ecuaciones:</label>
                        <input type="number" class="dimension-input" id="equations-rows" value="3" min="1" max="6" onchange="generateEquationInputs(this.value, document.getElementById('equations-cols').value)">
                        <label>Inc√≥gnitas:</label>
                        <input type="number" class="dimension-input" id="equations-cols" value="3" min="1" max="6" onchange="generateEquationInputs(document.getElementById('equations-rows').value, this.value)">
                    </div>
                    <div id="equations-inputs" class="matrix-grid"></div>
                </div>

                <div class="input-card">
                    <h3>üìù Vector de T√©rminos Independientes</h3>
                    <div id="constants-inputs" class="vector-grid"></div>
                </div>
            </div>

            <div class="operations-grid">
                <button class="operation-btn" onclick="solveSystemGauss()">üîç M√©todo de Gauss</button>
                <button class="operation-btn" onclick="solveSystemCramer()">üìê Regla de Cramer</button>
                <button class="operation-btn" onclick="solveSystemMatrix()">üîÑ M√©todo Matricial</button>
                <button class="operation-btn" onclick="systemDeterminant()">üéØ Determinante</button>
                <button class="operation-btn" onclick="systemRank()">üìè Rango</button>
                <button class="operation-btn" onclick="systemConsistency()">‚úÖ Consistencia</button>
            </div>

            <div class="result-card">
                <div id="equation-result" class="result-content">
                    <div class="empty-result">Los resultados aparecer√°n aqu√≠...</div>
                </div>
            </div>

            <div class="procedure-container">
                <div id="equation-procedure"></div>
            </div>
        </div>

        <!-- Nueva Secci√≥n de Calculadora -->
        <div id="calculator" class="section">
            <h2 class="section-title">Calculadora Cient√≠fica</h2>

            <div class="input-grid">
                <div class="input-card">
                    <h3>üß™ Operaciones Avanzadas</h3>
                    <div class="dimension-controls">
                        <label>Expresi√≥n:</label>
                        <input type="text" id="expression-input" placeholder="Ej: sin(30*pi/180)" style="width: 100%; padding: 10px; margin: 10px 0;">
                    </div>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="insertFunction('sin(')">sin</button>
                        <button class="quick-btn" onclick="insertFunction('cos(')">cos</button>
                        <button class="quick-btn" onclick="insertFunction('tan(')">tan</button>
                        <button class="quick-btn" onclick="insertFunction('log(')">log</button>
                        <button class="quick-btn" onclick="insertFunction('sqrt(')">‚àö</button>
                        <button class="quick-btn" onclick="insertFunction('pi')">œÄ</button>
                        <button class="quick-btn" onclick="insertFunction('e')">e</button>
                        <button class="quick-btn" onclick="clearExpression()">Limpiar</button>
                    </div>
                </div>

                <div class="input-card">
                    <h3>üìä Conversiones</h3>
                    <div class="dimension-controls">
                        <label>Grados:</label>
                        <input type="number" id="degrees-input" placeholder="√Ångulo en grados" style="width: 100px; padding: 8px; margin: 5px;">
                        <label>Radianes:</label>
                        <input type="number" id="radians-input" placeholder="√Ångulo en radianes" style="width: 100px; padding: 8px; margin: 5px;">
                    </div>
                    <div class="quick-fill">
                        <button class="quick-btn" onclick="convertToRadians()">¬∞ ‚Üí rad</button>
                        <button class="quick-btn" onclick="convertToDegrees()">rad ‚Üí ¬∞</button>
                    </div>
                </div>
            </div>

            <div class="operations-grid">
                <button class="operation-btn" onclick="evaluateExpression()">üßÆ Evaluar Expresi√≥n</button>
                <button class="operation-btn" onclick="calculateFactorial()">! Factorial</button>
                <button class="operation-btn" onclick="calculateCombination()">C(n,r) Combinaciones</button>
                <button class="operation-btn" onclick="calculatePermutation()">P(n,r) Permutaciones</button>
                <button class="operation-btn" onclick="calculateGCD()">MCD</button>
                <button class="operation-btn" onclick="calculateLCM()">MCM</button>
            </div>

            <div class="result-card">
                <div id="calculator-result" class="result-content">
                    <div class="empty-result">Los resultados aparecer√°n aqu√≠...</div>
                </div>
            </div>

            <div class="procedure-container">
                <div id="calculator-procedure"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n inicial de MathJax
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            options: {
                processHtmlClass: 'tex2jax_process',
                processEscapes: true
            }
        };

        // Clase Matrix mejorada
        class Matrix {
            constructor(data) {
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('Los datos de la matriz deben ser un array no vac√≠o');
                }
                this.data = data.map(row => [...row]); // Deep copy
                this.rows = data.length;
                this.cols = data[0].length;

                // Validar que todas las filas tengan la misma longitud
                if (!data.every(row => row.length === this.cols)) {
                    throw new Error('Todas las filas deben tener la misma cantidad de columnas');
                }
            }

            static add(a, b) {
                if (a.rows !== b.rows || a.cols !== b.cols) {
                    throw new Error('Las matrices deben tener las mismas dimensiones para sumar');
                }
                const result = [];
                for (let i = 0; i < a.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < a.cols; j++) {
                        result[i][j] = a.data[i][j] + b.data[i][j];
                    }
                }
                return new Matrix(result);
            }

            static subtract(a, b) {
                if (a.rows !== b.rows || a.cols !== b.cols) {
                    throw new Error('Las matrices deben tener las mismas dimensiones para restar');
                }
                const result = [];
                for (let i = 0; i < a.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < a.cols; j++) {
                        result[i][j] = a.data[i][j] - b.data[i][j];
                    }
                }
                return new Matrix(result);
            }

            static multiply(a, b) {
                if (a.cols !== b.rows) {
                    throw new Error('El n√∫mero de columnas de la primera matriz debe ser igual al n√∫mero de filas de la segunda matriz');
                }
                const result = [];
                for (let i = 0; i < a.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < b.cols; j++) {
                        let sum = 0;
                        for (let k = 0; k < a.cols; k++) {
                            sum += a.data[i][k] * b.data[k][j];
                        }
                        result[i][j] = sum;
                    }
                }
                return new Matrix(result);
            }

            transpose() {
                const result = [];
                for (let j = 0; j < this.cols; j++) {
                    result[j] = [];
                    for (let i = 0; i < this.rows; i++) {
                        result[j][i] = this.data[i][j];
                    }
                }
                return new Matrix(result);
            }

            determinant() {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para calcular el determinante');
                }
                if (this.rows === 1) {
                    return this.data[0][0];
                }
                if (this.rows === 2) {
                    return this.data[0][0] * this.data[1][1] - this.data[0][1] * this.data[1][0];
                }
                let det = 0;
                for (let j = 0; j < this.cols; j++) {
                    const submatrix = [];
                    for (let i = 1; i < this.rows; i++) {
                        submatrix[i - 1] = [];
                        for (let k = 0; k < this.cols; k++) {
                            if (k !== j) {
                                submatrix[i - 1].push(this.data[i][k]);
                            }
                        }
                    }
                    det += Math.pow(-1, j) * this.data[0][j] * new Matrix(submatrix).determinant();
                }
                return det;
            }

            scalarMultiply(scalar) {
                const result = [];
                for (let i = 0; i < this.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < this.cols; j++) {
                        result[i][j] = this.data[i][j] * scalar;
                    }
                }
                return new Matrix(result);
            }

            power(n) {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para calcular la potencia');
                }
                if (n === 0) {
                    const identity = [];
                    for (let i = 0; i < this.rows; i++) {
                        identity[i] = [];
                        for (let j = 0; j < this.cols; j++) {
                            identity[i][j] = i === j ? 1 : 0;
                        }
                    }
                    return new Matrix(identity);
                }
                let result = new Matrix(this.data);
                for (let i = 1; i < n; i++) {
                    result = Matrix.multiply(result, this);
                }
                return result;
            }

            inverse() {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para calcular la inversa');
                }
                const det = this.determinant();
                if (det === 0) {
                    throw new Error('La matriz no es invertible (determinante es cero)');
                }
                const adjugate = this.adjugate();
                const result = [];
                for (let i = 0; i < this.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < this.cols; j++) {
                        result[i][j] = adjugate.data[i][j] / det;
                    }
                }
                return new Matrix(result);
            }

            adjugate() {
                const cofactorMatrix = this.cofactorMatrix();
                return cofactorMatrix.transpose();
            }

            cofactorMatrix() {
                const result = [];
                for (let i = 0; i < this.rows; i++) {
                    result[i] = [];
                    for (let j = 0; j < this.cols; j++) {
                        const submatrix = [];
                        for (let m = 0; m < this.rows; m++) {
                            if (m !== i) {
                                submatrix.push([]);
                                for (let n = 0; n < this.cols; n++) {
                                    if (n !== j) {
                                        submatrix[submatrix.length - 1].push(this.data[m][n]);
                                    }
                                }
                            }
                        }
                        result[i][j] = Math.pow(-1, i + j) * new Matrix(submatrix).determinant();
                    }
                }
                return new Matrix(result);
            }

            rank() {
                const rref = this.rref();
                let rank = 0;
                for (let i = 0; i < rref.rows; i++) {
                    let allZeros = true;
                    for (let j = 0; j < rref.cols; j++) {
                        if (rref.data[i][j] !== 0) {
                            allZeros = false;
                            break;
                        }
                    }
                    if (!allZeros) {
                        rank++;
                    }
                }
                return rank;
            }

            rref() {
                const matrix = new Matrix(this.data);
                let lead = 0;
                for (let r = 0; r < matrix.rows; r++) {
                    if (lead >= matrix.cols) {
                        return matrix;
                    }
                    let i = r;
                    while (matrix.data[i][lead] === 0) {
                        i++;
                        if (i === matrix.rows) {
                            i = r;
                            lead++;
                            if (lead === matrix.cols) {
                                return matrix;
                            }
                        }
                    }
                    [matrix.data[i], matrix.data[r]] = [matrix.data[r], matrix.data[i]];
                    const lv = matrix.data[r][lead];
                    for (let j = 0; j < matrix.cols; j++) {
                        matrix.data[r][j] /= lv;
                    }
                    for (let i = 0; i < matrix.rows; i++) {
                        if (i !== r) {
                            const lv = matrix.data[i][lead];
                            for (let j = 0; j < matrix.cols; j++) {
                                matrix.data[i][j] -= lv * matrix.data[r][j];
                            }
                        }
                    }
                    lead++;
                }
                return matrix;
            }

            trace() {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para calcular la traza');
                }
                let trace = 0;
                for (let i = 0; i < this.rows; i++) {
                    trace += this.data[i][i];
                }
                return trace;
            }

            eigenvalues() {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para calcular los eigenvalores');
                }
                if (this.rows === 1) {
                    return [this.data[0][0]];
                }
                if (this.rows === 2) {
                    const a = this.data[0][0];
                    const b = this.data[0][1];
                    const c = this.data[1][0];
                    const d = this.data[1][1];
                    const trace = a + d;
                    const det = a * d - b * c;
                    const discriminant = trace * trace - 4 * det;
                    if (discriminant >= 0) {
                        return [(trace + Math.sqrt(discriminant)) / 2, (trace - Math.sqrt(discriminant)) / 2];
                    } else {
                        return [(trace + Math.sqrt(-discriminant)) / 2 + 'i', (trace - Math.sqrt(-discriminant)) / 2 + 'i'];
                    }
                }
                // Para matrices m√°s grandes, se puede usar el m√©todo de la potencia o QR
                throw new Error('C√°lculo de eigenvalores no implementado para matrices mayores a 2x2');
            }

            luDecomposition() {
                if (this.rows !== this.cols) {
                    throw new Error('La matriz debe ser cuadrada para la descomposici√≥n LU');
                }
                const n = this.rows;
                const L = new Array(n).fill().map(() => new Array(n).fill(0));
                const U = new Array(n).fill().map(() => new Array(n).fill(0));

                for (let i = 0; i < n; i++) {
                    // Descomposici√≥n de Doolittle
                    // U
                    for (let j = i; j < n; j++) {
                        let sum = 0;
                        for (let k = 0; k < i; k++) {
                            sum += L[i][k] * U[k][j];
                        }
                        U[i][j] = this.data[i][j] - sum;
                    }

                    // L
                    for (let j = i; j < n; j++) {
                        if (i === j) {
                            L[i][i] = 1;
                        } else {
                            let sum = 0;
                            for (let k = 0; k < i; k++) {
                                sum += L[j][k] * U[k][i];
                            }
                            L[j][i] = (this.data[j][i] - sum) / U[i][i];
                        }
                    }
                }

                return { L: new Matrix(L), U: new Matrix(U) };
            }
        }

        // Clase Vector
        class Vector {
            constructor(data) {
                this.data = [...data];
                this.dim = data.length;
            }

            static add(a, b) {
                if (a.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para sumar');
                }
                const result = [];
                for (let i = 0; i < a.dim; i++) {
                    result[i] = a.data[i] + b.data[i];
                }
                return new Vector(result);
            }

            static subtract(a, b) {
                if (a.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para restar');
                }
                const result = [];
                for (let i = 0; i < a.dim; i++) {
                    result[i] = a.data[i] - b.data[i];
                }
                return new Vector(result);
            }

            static dotProduct(a, b) {
                if (a.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para el producto escalar');
                }
                let result = 0;
                for (let i = 0; i < a.dim; i++) {
                    result += a.data[i] * b.data[i];
                }
                return result;
            }

            static crossProduct(a, b) {
                if (a.dim !== 3 || b.dim !== 3) {
                    throw new Error('El producto vectorial solo est√° definido para vectores en 3D');
                }
                return new Vector([
                    a.data[1] * b.data[2] - a.data[2] * b.data[1],
                    a.data[2] * b.data[0] - a.data[0] * b.data[2],
                    a.data[0] * b.data[1] - a.data[1] * b.data[0]
                ]);
            }

            magnitude() {
                let sum = 0;
                for (let i = 0; i < this.dim; i++) {
                    sum += this.data[i] * this.data[i];
                }
                return Math.sqrt(sum);
            }

            angle(b) {
                if (this.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para calcular el √°ngulo');
                }
                const dot = Vector.dotProduct(this, b);
                const magA = this.magnitude();
                const magB = b.magnitude();
                return Math.acos(dot / (magA * magB));
            }

            normalize() {
                const mag = this.magnitude();
                const result = [];
                for (let i = 0; i < this.dim; i++) {
                    result[i] = this.data[i] / mag;
                }
                return new Vector(result);
            }

            project(b) {
                if (this.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para la proyecci√≥n');
                }
                const dot = Vector.dotProduct(this, b);
                const magB = b.magnitude();
                const scalar = dot / (magB * magB);
                const result = [];
                for (let i = 0; i < this.dim; i++) {
                    result[i] = scalar * b.data[i];
                }
                return new Vector(result);
            }

            distance(b) {
                if (this.dim !== b.dim) {
                    throw new Error('Los vectores deben tener la misma dimensi√≥n para calcular la distancia');
                }
                let sum = 0;
                for (let i = 0; i < this.dim; i++) {
                    sum += Math.pow(this.data[i] - b.data[i], 2);
                }
                return Math.sqrt(sum);
            }

            tripleProduct(b, c) {
                if (this.dim !== 3 || b.dim !== 3 || c.dim !== 3) {
                    throw new Error('El producto triple solo est√° definido para vectores en 3D');
                }
                return Vector.crossProduct(this, Vector.crossProduct(b, c));
            }

            scalarTripleProduct(b, c) {
                if (this.dim !== 3 || b.dim !== 3 || c.dim !== 3) {
                    throw new Error('El producto triple escalar solo est√° definido para vectores en 3D');
                }
                return Vector.dotProduct(this, Vector.crossProduct(b, c));
            }

            perpendicular() {
                if (this.dim !== 3) {
                    throw new Error('El vector perpendicular solo est√° definido para vectores en 3D');
                }
                // Encontrar un vector perpendicular arbitrario
                let result;
                if (this.data[0] !== 0 || this.data[1] !== 0) {
                    result = new Vector([-this.data[1], this.data[0], 0]);
                } else {
                    result = new Vector([0, -this.data[2], this.data[1]]);
                }
                return result.normalize();
            }
        }

        // Funciones para generar inputs de matrices y vectores
        function generateMatrixInputs(matrixId, rows, cols) {
            const container = document.getElementById(`${matrixId}-inputs`);
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'matrix-input';
                    input.id = `${matrixId}-${i}-${j}`;
                    input.value = '0';
                    container.appendChild(input);
                }
            }
        }

        function generateVectorInputs(vectorId, dim) {
            const container = document.getElementById(`${vectorId}-inputs`);
            container.innerHTML = '';
            container.style.gridTemplateColumns = '1fr';

            for (let i = 0; i < dim; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'vector-input';
                input.id = `${vectorId}-${i}`;
                input.value = '0';
                container.appendChild(input);
            }
        }

        function generateEquationInputs(rows, cols) {
            const matrixContainer = document.getElementById('equations-inputs');
            matrixContainer.innerHTML = '';
            matrixContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            const constantsContainer = document.getElementById('constants-inputs');
            constantsContainer.innerHTML = '';
            constantsContainer.style.gridTemplateColumns = '1fr';

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'matrix-input';
                    input.id = `equation-${i}-${j}`;
                    input.value = '0';
                    matrixContainer.appendChild(input);
                }
                const constantInput = document.createElement('input');
                constantInput.type = 'number';
                constantInput.className = 'vector-input';
                constantInput.id = `constant-${i}`;
                constantInput.value = '0';
                constantsContainer.appendChild(constantInput);
            }
        }

        // Funciones para llenar matrices y vectores con valores predefinidos
        function fillMatrix(matrixId, type) {
            const rows = parseInt(document.getElementById(`${matrixId}-rows`).value);
            const cols = parseInt(document.getElementById(`${matrixId}-cols`).value);

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.getElementById(`${matrixId}-${i}-${j}`);
                    switch (type) {
                        case 'identity':
                            input.value = i === j ? '1' : '0';
                            break;
                        case 'zeros':
                            input.value = '0';
                            break;
                        case 'ones':
                            input.value = '1';
                            break;
                        case 'random':
                            input.value = Math.floor(Math.random() * 10);
                            break;
                    }
                }
            }
        }

        function fillVector(vectorId, type) {
            const dim = parseInt(document.getElementById(`${vectorId}-dim`).value);

            for (let i = 0; i < dim; i++) {
                const input = document.getElementById(`${vectorId}-${i}`);
                switch (type) {
                    case 'zeros':
                        input.value = '0';
                        break;
                    case 'ones':
                        input.value = '1';
                        break;
                    case 'random':
                        input.value = Math.floor(Math.random() * 10);
                        break;
                    case 'unit':
                        input.value = i === 0 ? '1' : '0';
                        break;
                }
            }
        }

        function fillEquationMatrix(type) {
            const rows = parseInt(document.getElementById('equations-rows').value);
            const cols = parseInt(document.getElementById('equations-cols').value);

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.getElementById(`equation-${i}-${j}`);
                    switch (type) {
                        case 'random':
                            input.value = Math.floor(Math.random() * 10);
                            break;
                        case 'example':
                            if (rows === 3 && cols === 3) {
                                const examples = [
                                    [2, 1, -1],
                                    [-3, -1, 2],
                                    [-2, 1, 2]
                                ];
                                input.value = examples[i][j];
                            } else {
                                input.value = Math.floor(Math.random() * 10);
                            }
                            break;
                    }
                }
                const constantInput = document.getElementById(`constant-${i}`);
                switch (type) {
                    case 'random':
                        constantInput.value = Math.floor(Math.random() * 10);
                        break;
                    case 'example':
                        if (rows === 3) {
                            const examples = [8, -11, -3];
                            constantInput.value = examples[i];
                        } else {
                            constantInput.value = Math.floor(Math.random() * 10);
                        }
                        break;
                }
            }
        }

        function clearMatrix(matrixId) {
            const rows = parseInt(document.getElementById(`${matrixId}-rows`).value);
            const cols = parseInt(document.getElementById(`${matrixId}-cols`).value);

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    document.getElementById(`${matrixId}-${i}-${j}`).value = '0';
                }
            }
        }

        function clearVector(vectorId) {
            const dim = parseInt(document.getElementById(`${vectorId}-dim`).value);

            for (let i = 0; i < dim; i++) {
                document.getElementById(`${vectorId}-${i}`).value = '0';
            }
        }

        function clearEquationMatrix() {
            const rows = parseInt(document.getElementById('equations-rows').value);
            const cols = parseInt(document.getElementById('equations-cols').value);

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    document.getElementById(`equation-${i}-${j}`).value = '0';
                }
                document.getElementById(`constant-${i}`).value = '0';
            }
        }

        // Funciones para operaciones con matrices
        function addMatrices() {
            try {
                const a = getMatrix('matrix-a');
                const b = getMatrix('matrix-b');
                const result = Matrix.add(a, b);
                displayMatrixResult('Suma de Matrices', result);
                displayMatrixProcedure('Suma de Matrices', a, b, result, 'add');
            } catch (error) {
                displayError(error.message);
            }
        }

        function subtractMatrices() {
            try {
                const a = getMatrix('matrix-a');
                const b = getMatrix('matrix-b');
                const result = Matrix.subtract(a, b);
                displayMatrixResult('Resta de Matrices', result);
                displayMatrixProcedure('Resta de Matrices', a, b, result, 'subtract');
            } catch (error) {
                displayError(error.message);
            }
        }

        function multiplyMatrices() {
            try {
                const a = getMatrix('matrix-a');
                const b = getMatrix('matrix-b');
                const result = Matrix.multiply(a, b);
                displayMatrixResult('Multiplicaci√≥n de Matrices', result);
                displayMatrixProcedure('Multiplicaci√≥n de Matrices', a, b, result, 'multiply');
            } catch (error) {
                displayError(error.message);
            }
        }

        function transposeMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.transpose();
                displayMatrixResult('Transpuesta de Matriz', result);
                displayMatrixProcedure('Transpuesta de Matriz', a, null, result, 'transpose');
            } catch (error) {
                displayError(error.message);
            }
        }

        function determinantMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.determinant();
                displayScalarResult('Determinante de Matriz', result);
                displayMatrixProcedure('Determinante de Matriz', a, null, null, 'determinant', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function scalarMultiply() {
            try {
                const a = getMatrix('matrix-a');
                const scalar = parseFloat(prompt('Ingrese el escalar:'));
                if (isNaN(scalar)) {
                    throw new Error('El escalar debe ser un n√∫mero v√°lido');
                }
                const result = a.scalarMultiply(scalar);
                displayMatrixResult('Multiplicaci√≥n por Escalar', result);
                displayMatrixProcedure('Multiplicaci√≥n por Escalar', a, null, result, 'scalarMultiply', scalar);
            } catch (error) {
                displayError(error.message);
            }
        }

        function matrixPower() {
            try {
                const a = getMatrix('matrix-a');
                const n = parseInt(prompt('Ingrese la potencia:'));
                if (isNaN(n)) {
                    throw new Error('La potencia debe ser un n√∫mero entero v√°lido');
                }
                const result = a.power(n);
                displayMatrixResult('Potencia de Matriz', result);
                displayMatrixProcedure('Potencia de Matriz', a, null, result, 'power', n);
            } catch (error) {
                displayError(error.message);
            }
        }

        function inverseMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.inverse();
                displayMatrixResult('Inversa de Matriz', result);
                displayMatrixProcedure('Inversa de Matriz', a, null, result, 'inverse');
            } catch (error) {
                displayError(error.message);
            }
        }

        function rankMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.rank();
                displayScalarResult('Rango de Matriz', result);
                displayMatrixProcedure('Rango de Matriz', a, null, null, 'rank', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function traceMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.trace();
                displayScalarResult('Traza de Matriz', result);
                displayMatrixProcedure('Traza de Matriz', a, null, null, 'trace', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function eigenvaluesMatrix() {
            try {
                const a = getMatrix('matrix-a');
                const result = a.eigenvalues();
                displayVectorResult('Eigenvalores de Matriz', result);
                displayMatrixProcedure('Eigenvalores de Matriz', a, null, null, 'eigenvalues', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function luDecomposition() {
            try {
                const a = getMatrix('matrix-a');
                const { L, U } = a.luDecomposition();
                displayMatrixResult('Descomposici√≥n LU - L', L);
                displayMatrixResult('Descomposici√≥n LU - U', U);
                displayMatrixProcedure('Descomposici√≥n LU', a, null, { L, U }, 'luDecomposition');
            } catch (error) {
                displayError(error.message);
            }
        }

        function determinantAx() {
            try {
                const a = getMatrix('matrix-a');
                const b = getVector('vector-b').data;
                const Aj = JSON.parse(JSON.stringify(a.data));
                for (let i = 0; i < a.rows; i++) {
                    Aj[i][0] = b[i];
                }
                const detAj = new Matrix(Aj).determinant();
                displayScalarResult('Determinante de Ax', detAj);
                displayMatrixProcedure('Determinante de Ax', new Matrix(Aj), null, null, 'determinantAx', detAj);
            } catch (error) {
                displayError(error.message);
            }
        }

        function determinantAy() {
            try {
                const a = getMatrix('matrix-a');
                const b = getVector('vector-b').data;
                const Aj = JSON.parse(JSON.stringify(a.data));
                for (let i = 0; i < a.rows; i++) {
                    Aj[i][1] = b[i];
                }
                const detAj = new Matrix(Aj).determinant();
                displayScalarResult('Determinante de Ay', detAj);
                displayMatrixProcedure('Determinante de Ay', new Matrix(Aj), null, null, 'determinantAy', detAj);
            } catch (error) {
                displayError(error.message);
            }
        }

        function determinantAz() {
            try {
                const a = getMatrix('matrix-a');
                const b = getVector('vector-b').data;
                const Aj = JSON.parse(JSON.stringify(a.data));
                for (let i = 0; i < a.rows; i++) {
                    Aj[i][2] = b[i];
                }
                const detAj = new Matrix(Aj).determinant();
                displayScalarResult('Determinante de Az', detAj);
                displayMatrixProcedure('Determinante de Az', new Matrix(Aj), null, null, 'determinantAz', detAj);
            } catch (error) {
                displayError(error.message);
            }
        }

        // Funciones para operaciones con vectores
        function addVectors() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = Vector.add(a, b);
                displayVectorResult('Suma de Vectores', result);
                displayVectorProcedure('Suma de Vectores', a, b, result, 'add');
            } catch (error) {
                displayError(error.message);
            }
        }

        function subtractVectors() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = Vector.subtract(a, b);
                displayVectorResult('Resta de Vectores', result);
                displayVectorProcedure('Resta de Vectores', a, b, result, 'subtract');
            } catch (error) {
                displayError(error.message);
            }
        }

        function dotProduct() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = Vector.dotProduct(a, b);
                displayScalarResult('Producto Escalar', result);
                displayVectorProcedure('Producto Escalar', a, b, null, 'dotProduct', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function crossProduct() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = Vector.crossProduct(a, b);
                displayVectorResult('Producto Vectorial', result);
                displayVectorProcedure('Producto Vectorial', a, b, result, 'crossProduct');
            } catch (error) {
                displayError(error.message);
            }
        }

        function vectorMagnitude() {
            try {
                const a = getVector('vector-a');
                const result = a.magnitude();
                displayScalarResult('Magnitud de Vector', result);
                displayVectorProcedure('Magnitud de Vector', a, null, null, 'magnitude', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function vectorAngle() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = a.angle(b);
                displayScalarResult('√Ångulo entre Vectores (radianes)', result);
                displayVectorProcedure('√Ångulo entre Vectores', a, b, null, 'angle', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function normalizeVector() {
            try {
                const a = getVector('vector-a');
                const result = a.normalize();
                displayVectorResult('Vector Normalizado', result);
                displayVectorProcedure('Vector Normalizado', a, null, result, 'normalize');
            } catch (error) {
                displayError(error.message);
            }
        }

        function projectVector() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = a.project(b);
                displayVectorResult('Proyecci√≥n de Vector', result);
                displayVectorProcedure('Proyecci√≥n de Vector', a, b, result, 'project');
            } catch (error) {
                displayError(error.message);
            }
        }

        function distanceBetweenVectors() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const result = a.distance(b);
                displayScalarResult('Distancia entre Vectores', result);
                displayVectorProcedure('Distancia entre Vectores', a, b, null, 'distance', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function vectorTripleProduct() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const c = getVector('vector-b'); // Usando el mismo vector para simplificar
                const result = a.tripleProduct(b, c);
                displayVectorResult('Producto Triple Vectorial', result);
                displayVectorProcedure('Producto Triple Vectorial', a, b, result, 'tripleProduct', c);
            } catch (error) {
                displayError(error.message);
            }
        }

        function scalarTripleProduct() {
            try {
                const a = getVector('vector-a');
                const b = getVector('vector-b');
                const c = getVector('vector-b'); // Usando el mismo vector para simplificar
                const result = a.scalarTripleProduct(b, c);
                displayScalarResult('Producto Triple Escalar', result);
                displayVectorProcedure('Producto Triple Escalar', a, b, null, 'scalarTripleProduct', { c, result });
            } catch (error) {
                displayError(error.message);
            }
        }

        function vectorPerpendicular() {
            try {
                const a = getVector('vector-a');
                const result = a.perpendicular();
                displayVectorResult('Vector Perpendicular', result);
                displayVectorProcedure('Vector Perpendicular', a, null, result, 'perpendicular');
            } catch (error) {
                displayError(error.message);
            }
        }

        // Funciones para operaciones con sistemas de ecuaciones
        function solveSystemGauss() {
            try {
                const { A, b } = getEquationSystem();
                const result = solveGauss(A, b);
                displayVectorResult('Soluci√≥n por M√©todo de Gauss', result);
                displayEquationProcedure('M√©todo de Gauss', A, b, result, 'gauss');
            } catch (error) {
                displayError(error.message);
            }
        }

        function solveSystemCramer() {
            try {
                const { A, b } = getEquationSystem();
                const result = solveCramer(A, b);
                displayVectorResult('Soluci√≥n por Regla de Cramer', result);
                displayEquationProcedure('Regla de Cramer', A, b, result, 'cramer');
            } catch (error) {
                displayError(error.message);
            }
        }

        function solveSystemMatrix() {
            try {
                const { A, b } = getEquationSystem();
                const result = solveMatrix(A, b);
                displayVectorResult('Soluci√≥n por M√©todo Matricial', result);
                displayEquationProcedure('M√©todo Matricial', A, b, result, 'matrix');
            } catch (error) {
                displayError(error.message);
            }
        }

        function systemDeterminant() {
            try {
                const { A } = getEquationSystem();
                const result = new Matrix(A).determinant();
                displayScalarResult('Determinante del Sistema', result);
                displayEquationProcedure('Determinante del Sistema', A, null, null, 'determinant', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function systemRank() {
            try {
                const { A } = getEquationSystem();
                const result = new Matrix(A).rank();
                displayScalarResult('Rango del Sistema', result);
                displayEquationProcedure('Rango del Sistema', A, null, null, 'rank', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function systemConsistency() {
            try {
                const { A, b } = getEquationSystem();
                const result = checkConsistency(A, b);
                displayScalarResult('Consistencia del Sistema', result ? 'Consistente' : 'Inconsistente');
                displayEquationProcedure('Consistencia del Sistema', A, b, null, 'consistency', result);
            } catch (error) {
                displayError(error.message);
            }
        }

        // Funciones para operaciones con calculadora
        function evaluateExpression() {
            try {
                const expression = document.getElementById('expression-input').value;
                const result = math.evaluate(expression);
                displayScalarResult('Resultado de Expresi√≥n', result);
                displayCalculatorProcedure('Evaluar Expresi√≥n', expression, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function calculateFactorial() {
            try {
                const n = parseInt(prompt('Ingrese un n√∫mero entero:'));
                if (isNaN(n) || n < 0) {
                    throw new Error('Debe ingresar un n√∫mero entero no negativo');
                }
                const result = factorial(n);
                displayScalarResult('Factorial', result);
                displayCalculatorProcedure('Factorial', n, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function calculateCombination() {
            try {
                const n = parseInt(prompt('Ingrese n:'));
                const r = parseInt(prompt('Ingrese r:'));
                if (isNaN(n) || isNaN(r) || n < 0 || r < 0 || r > n) {
                    throw new Error('Valores inv√°lidos para n y r');
                }
                const result = combination(n, r);
                displayScalarResult('Combinaci√≥n C(n,r)', result);
                displayCalculatorProcedure('Combinaci√≥n C(n,r)', { n, r }, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function calculatePermutation() {
            try {
                const n = parseInt(prompt('Ingrese n:'));
                const r = parseInt(prompt('Ingrese r:'));
                if (isNaN(n) || isNaN(r) || n < 0 || r < 0 || r > n) {
                    throw new Error('Valores inv√°lidos para n y r');
                }
                const result = permutation(n, r);
                displayScalarResult('Permutaci√≥n P(n,r)', result);
                displayCalculatorProcedure('Permutaci√≥n P(n,r)', { n, r }, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function calculateGCD() {
            try {
                const a = parseInt(prompt('Ingrese el primer n√∫mero:'));
                const b = parseInt(prompt('Ingrese el segundo n√∫mero:'));
                if (isNaN(a) || isNaN(b)) {
                    throw new Error('Debe ingresar n√∫meros v√°lidos');
                }
                const result = gcd(a, b);
                displayScalarResult('MCD', result);
                displayCalculatorProcedure('MCD', { a, b }, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function calculateLCM() {
            try {
                const a = parseInt(prompt('Ingrese el primer n√∫mero:'));
                const b = parseInt(prompt('Ingrese el segundo n√∫mero:'));
                if (isNaN(a) || isNaN(b)) {
                    throw new Error('Debe ingresar n√∫meros v√°lidos');
                }
                const result = lcm(a, b);
                displayScalarResult('MCM', result);
                displayCalculatorProcedure('MCM', { a, b }, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function convertToRadians() {
            try {
                const degrees = parseFloat(document.getElementById('degrees-input').value);
                if (isNaN(degrees)) {
                    throw new Error('Debe ingresar un n√∫mero v√°lido');
                }
                const result = degrees * Math.PI / 180;
                document.getElementById('radians-input').value = result.toFixed(4);
                displayScalarResult('Conversi√≥n a Radianes', result);
                displayCalculatorProcedure('Conversi√≥n a Radianes', degrees, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function convertToDegrees() {
            try {
                const radians = parseFloat(document.getElementById('radians-input').value);
                if (isNaN(radians)) {
                    throw new Error('Debe ingresar un n√∫mero v√°lido');
                }
                const result = radians * 180 / Math.PI;
                document.getElementById('degrees-input').value = result.toFixed(4);
                displayScalarResult('Conversi√≥n a Grados', result);
                displayCalculatorProcedure('Conversi√≥n a Grados', radians, result);
            } catch (error) {
                displayError(error.message);
            }
        }

        function insertFunction(func) {
            const expressionInput = document.getElementById('expression-input');
            expressionInput.value += func;
        }

        function clearExpression() {
            document.getElementById('expression-input').value = '';
        }

        // Funciones auxiliares para obtener matrices y vectores
        function getMatrix(matrixId) {
            const rows = parseInt(document.getElementById(`${matrixId}-rows`).value);
            const cols = parseInt(document.getElementById(`${matrixId}-cols`).value);
            const data = [];

            for (let i = 0; i < rows; i++) {
                data[i] = [];
                for (let j = 0; j < cols; j++) {
                    const value = parseFloat(document.getElementById(`${matrixId}-${i}-${j}`).value);
                    if (isNaN(value)) {
                        throw new Error(`Valor inv√°lido en la posici√≥n (${i+1}, ${j+1})`);
                    }
                    data[i][j] = value;
                }
            }

            return new Matrix(data);
        }

        function getVector(vectorId) {
            const dim = parseInt(document.getElementById(`${vectorId}-dim`).value);
            const data = [];

            for (let i = 0; i < dim; i++) {
                const value = parseFloat(document.getElementById(`${vectorId}-${i}`).value);
                if (isNaN(value)) {
                    throw new Error(`Valor inv√°lido en la posici√≥n ${i+1}`);
                }
                data[i] = value;
            }

            return new Vector(data);
        }

        function getEquationSystem() {
            const rows = parseInt(document.getElementById('equations-rows').value);
            const cols = parseInt(document.getElementById('equations-cols').value);
            const A = [];
            const b = [];

            for (let i = 0; i < rows; i++) {
                A[i] = [];
                for (let j = 0; j < cols; j++) {
                    const value = parseFloat(document.getElementById(`equation-${i}-${j}`).value);
                    if (isNaN(value)) {
                        throw new Error(`Valor inv√°lido en la posici√≥n (${i+1}, ${j+1})`);
                    }
                    A[i][j] = value;
                }
                const constantValue = parseFloat(document.getElementById(`constant-${i}`).value);
                if (isNaN(constantValue)) {
                    throw new Error(`Valor inv√°lido en el t√©rmino independiente ${i+1}`);
                }
                b[i] = constantValue;
            }

            return { A, b };
        }

        // Funciones para resolver sistemas de ecuaciones
        function solveGauss(A, b) {
            const n = A.length;
            const augmented = [];

            for (let i = 0; i < n; i++) {
                augmented[i] = [...A[i], b[i]];
            }

            for (let i = 0; i < n; i++) {
                // B√∫squeda de pivote
                let max = Math.abs(augmented[i][i]);
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(augmented[k][i]) > max) {
                        max = Math.abs(augmented[k][i]);
                        maxRow = k;
                    }
                }

                // Intercambio de filas
                [augmented[i], augmented[maxRow]] = [augmented[maxRow], augmented[i]];

                // Eliminaci√≥n hacia adelante
                for (let k = i + 1; k < n; k++) {
                    const factor = augmented[k][i] / augmented[i][i];
                    for (let j = 0; j <= n; j++) {
                        augmented[k][j] -= factor * augmented[i][j];
                    }
                }
            }

            // Sustituci√≥n hacia atr√°s
            const x = new Array(n);
            for (let i = n - 1; i >= 0; i--) {
                x[i] = augmented[i][n];
                for (let j = i + 1; j < n; j++) {
                    x[i] -= augmented[i][j] * x[j];
                }
                x[i] /= augmented[i][i];
            }

            return x;
        }

        function solveCramer(A, b) {
            const n = A.length;
            const detA = new Matrix(A).determinant();
            if (detA === 0) {
                throw new Error('El sistema no tiene soluci√≥n √∫nica (determinante es cero)');
            }

            const x = new Array(n);
            for (let j = 0; j < n; j++) {
                const Aj = JSON.parse(JSON.stringify(A));
                for (let i = 0; i < n; i++) {
                    Aj[i][j] = b[i];
                }
                const detAj = new Matrix(Aj).determinant();
                x[j] = detAj / detA;
            }

            return x;
        }

        function solveMatrix(A, b) {
            const matrixA = new Matrix(A);
            const invA = matrixA.inverse();
            const vectorB = new Vector(b);
            const result = invA.multiply(new Matrix([vectorB.data])).data[0];
            return result;
        }

        function checkConsistency(A, b) {
            const augmented = [];
            const n = A.length;
            const m = A[0].length;

            for (let i = 0; i < n; i++) {
                augmented[i] = [...A[i], b[i]];
            }

            let rankA = 0;
            let rankAugmented = 0;

            // Calcular rango de A
            const tempA = JSON.parse(JSON.stringify(A));
            for (let i = 0; i < n; i++) {
                let allZeros = true;
                for (let j = 0; j < m; j++) {
                    if (tempA[i][j] !== 0) {
                        allZeros = false;
                        break;
                    }
                }
                if (!allZeros) {
                    rankA++;
                }
            }

            // Calcular rango de la matriz aumentada
            for (let i = 0; i < n; i++) {
                let allZeros = true;
                for (let j = 0; j <= m; j++) {
                    if (augmented[i][j] !== 0) {
                        allZeros = false;
                        break;
                    }
                }
                if (!allZeros) {
                    rankAugmented++;
                }
            }

            return rankA === rankAugmented;
        }

        // Funciones matem√°ticas auxiliares
        function factorial(n) {
            if (n === 0 || n === 1) {
                return 1;
            }
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }

        function combination(n, r) {
            return factorial(n) / (factorial(r) * factorial(n - r));
        }

        function permutation(n, r) {
            return factorial(n) / factorial(n - r);
        }

        function gcd(a, b) {
            if (b === 0) {
                return a;
            }
            return gcd(b, a % b);
        }

        function lcm(a, b) {
            return (a * b) / gcd(a, b);
        }

        // Funciones para mostrar resultados
        function displayMatrixResult(title, matrix) {
            const resultDiv = document.getElementById('matrix-result');
            resultDiv.innerHTML = `
                <div class="result-title">${title}</div>
                <div class="matrix-display">
                    ${matrixToString(matrix)}
                </div>
                <button class="copy-btn" onclick="copyToClipboard('${matrixToString(matrix)}')">Copiar</button>
            `;
        }

        function displayVectorResult(title, vector) {
            const resultDiv = document.getElementById(vector instanceof Vector ? 'vector-result' : 'equation-result');
            resultDiv.innerHTML = `
                <div class="result-title">${title}</div>
                <div class="vector-display">
                    ${vectorToString(vector)}
                </div>
                <button class="copy-btn" onclick="copyToClipboard('${vectorToString(vector)}')">Copiar</button>
            `;
        }

        function displayScalarResult(title, value) {
            const resultDiv = document.getElementById('matrix-result');
            resultDiv.innerHTML = `
                <div class="result-title">${title}</div>
                <div class="result-content">
                    ${value}
                </div>
                <button class="copy-btn" onclick="copyToClipboard('${value}')">Copiar</button>
            `;
        }

        function displayError(message) {
            const resultDiv = document.getElementById('matrix-result');
            resultDiv.innerHTML = `
                <div class="error-message">
                    Error: ${message}
                </div>
            `;
        }

        function displayMatrixProcedure(title, a, b, result, operation, extra) {
            const procedureDiv = document.getElementById('matrix-procedure');
            let procedureHTML = `<div class="procedure-title">${title}</div>`;

            if (a) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Matriz A:</strong>
                            <div class="matrix-display">
                                ${matrixToString(a)}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (b) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Matriz B:</strong>
                            <div class="matrix-display">
                                ${matrixToString(b)}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (operation === 'add') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Sumar los elementos correspondientes de A y B.
                            <div class="matrix-display">
                                ${matrixToString(a)} + ${matrixToString(b)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'subtract') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Restar los elementos correspondientes de A y B.
                            <div class="matrix-display">
                                ${matrixToString(a)} - ${matrixToString(b)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'multiply') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Multiplicar cada fila de A por cada columna de B y sumar los productos.
                            <div class="matrix-display">
                                ${matrixToString(a)} √ó ${matrixToString(b)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'transpose') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Intercambiar filas por columnas.
                            <div class="matrix-display">
                                Transpuesta de ${matrixToString(a)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'determinant') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante usando expansi√≥n por cofactores.
                            <div class="matrix-display">
                                Determinante de ${matrixToString(a)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'scalarMultiply') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Multiplicar cada elemento de A por el escalar ${extra}.
                            <div class="matrix-display">
                                ${extra} √ó ${matrixToString(a)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'power') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Multiplicar la matriz por s√≠ misma ${extra} veces.
                            <div class="matrix-display">
                                ${matrixToString(a)}^${extra} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'inverse') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular la matriz adjunta y dividir por el determinante.
                            <div class="matrix-display">
                                Inversa de ${matrixToString(a)} = ${matrixToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'rank') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Reducir la matriz a su forma escalonada por filas.
                            <div class="matrix-display">
                                Rango de ${matrixToString(a)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'trace') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Sumar los elementos de la diagonal principal.
                            <div class="matrix-display">
                                Traza de ${matrixToString(a)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'eigenvalues') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Resolver la ecuaci√≥n caracter√≠stica det(A - ŒªI) = 0.
                            <div class="matrix-display">
                                Eigenvalores de ${matrixToString(a)} = [${extra.join(', ')}]
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'luDecomposition') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Descomponer A en una matriz triangular inferior L y una matriz triangular superior U.
                            <div class="matrix-display">
                                L = ${matrixToString(extra.L)}
                            </div>
                            <div class="matrix-display">
                                U = ${matrixToString(extra.U)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'determinantAx') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante de Ax.
                            <div class="matrix-display">
                                Determinante de Ax = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'determinantAy') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante de Ay.
                            <div class="matrix-display">
                                Determinante de Ay = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'determinantAz') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante de Az.
                            <div class="matrix-display">
                                Determinante de Az = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            }

            procedureDiv.innerHTML = procedureHTML;
        }

        function displayVectorProcedure(title, a, b, result, operation, extra) {
            const procedureDiv = document.getElementById('vector-procedure');
            let procedureHTML = `<div class="procedure-title">${title}</div>`;

            if (a) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Vector A:</strong>
                            <div class="vector-display">
                                ${vectorToString(a)}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (b) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Vector B:</strong>
                            <div class="vector-display">
                                ${vectorToString(b)}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (operation === 'add') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Sumar los componentes correspondientes de A y B.
                            <div class="vector-display">
                                ${vectorToString(a)} + ${vectorToString(b)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'subtract') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Restar los componentes correspondientes de A y B.
                            <div class="vector-display">
                                ${vectorToString(a)} - ${vectorToString(b)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'dotProduct') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Multiplicar los componentes correspondientes y sumar los productos.
                            <div class="vector-display">
                                ${vectorToString(a)} ¬∑ ${vectorToString(b)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'crossProduct') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el producto vectorial usando el determinante.
                            <div class="vector-display">
                                ${vectorToString(a)} √ó ${vectorToString(b)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'magnitude') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular la ra√≠z cuadrada de la suma de los cuadrados de los componentes.
                            <div class="vector-display">
                                Magnitud de ${vectorToString(a)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'angle') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Usar el producto escalar y las magnitudes para calcular el √°ngulo.
                            <div class="vector-display">
                                √Ångulo entre ${vectorToString(a)} y ${vectorToString(b)} = ${extra} radianes
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'normalize') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Dividir cada componente por la magnitud del vector.
                            <div class="vector-display">
                                Normalizaci√≥n de ${vectorToString(a)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'project') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular la proyecci√≥n de A sobre B.
                            <div class="vector-display">
                                Proyecci√≥n de ${vectorToString(a)} sobre ${vectorToString(b)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'distance') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular la distancia euclidiana entre A y B.
                            <div class="vector-display">
                                Distancia entre ${vectorToString(a)} y ${vectorToString(b)} = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'tripleProduct') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el producto triple vectorial A √ó (B √ó C).
                            <div class="vector-display">
                                ${vectorToString(a)} √ó (${vectorToString(b)} √ó ${vectorToString(extra)}) = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'scalarTripleProduct') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el producto triple escalar A ¬∑ (B √ó C).
                            <div class="vector-display">
                                ${vectorToString(a)} ¬∑ (${vectorToString(b)} √ó ${vectorToString(extra.c)}) = ${extra.result}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'perpendicular') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Encontrar un vector perpendicular a A.
                            <div class="vector-display">
                                Vector perpendicular a ${vectorToString(a)} = ${vectorToString(result)}
                            </div>
                        </div>
                    </div>
                `;
            }

            procedureDiv.innerHTML = procedureHTML;
        }

        function displayEquationProcedure(title, A, b, result, operation, extra) {
            const procedureDiv = document.getElementById('equation-procedure');
            let procedureHTML = `<div class="procedure-title">${title}</div>`;

            if (A) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Matriz de Coeficientes:</strong>
                            <div class="matrix-display">
                                ${matrixToString(new Matrix(A))}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (b) {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Vector de T√©rminos Independientes:</strong>
                            <div class="vector-display">
                                ${vectorToString(new Vector(b))}
                            </div>
                        </div>
                    </div>
                `;
            }

            if (operation === 'gauss') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Reducir la matriz aumentada a su forma escalonada por filas.
                            <div class="vector-display">
                                Soluci√≥n: [${result.join(', ')}]
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'cramer') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante de A y los determinantes de las matrices modificadas.
                            <div class="vector-display">
                                Soluci√≥n: [${result.join(', ')}]
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'matrix') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Multiplicar la inversa de A por el vector de t√©rminos independientes.
                            <div class="vector-display">
                                Soluci√≥n: [${result.join(', ')}]
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'determinant') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Calcular el determinante de la matriz de coeficientes.
                            <div class="matrix-display">
                                Determinante = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'rank') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Reducir la matriz a su forma escalonada por filas.
                            <div class="matrix-display">
                                Rango = ${extra}
                            </div>
                        </div>
                    </div>
                `;
            } else if (operation === 'consistency') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Paso 1:</strong> Comparar el rango de la matriz de coeficientes con el de la matriz aumentada.
                            <div class="matrix-display">
                                El sistema es ${extra ? 'consistente' : 'inconsistente'}
                            </div>
                        </div>
                    </div>
                `;
            }

            procedureDiv.innerHTML = procedureHTML;
        }

        function displayCalculatorProcedure(title, input, result) {
            const procedureDiv = document.getElementById('calculator-procedure');
            let procedureHTML = `<div class="procedure-title">${title}</div>`;

            if (typeof input === 'string') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Expresi√≥n:</strong>
                            <div class="result-content">
                                ${input}
                            </div>
                        </div>
                    </div>
                `;
            } else if (typeof input === 'object') {
                procedureHTML += `
                    <div class="steps-visualization">
                        <div class="procedure-steps">
                            <strong>Entrada:</strong>
                            <div class="result-content">
                                ${JSON.stringify(input)}
                            </div>
                        </div>
                    </div>
                `;
            }

            procedureHTML += `
                <div class="steps-visualization">
                    <div class="procedure-steps">
                        <strong>Resultado:</strong>
                        <div class="result-content">
                            ${result}
                        </div>
                    </div>
                </div>
            `;

            procedureDiv.innerHTML = procedureHTML;
        }

        function matrixToString(matrix) {
            let str = '';
            for (let i = 0; i < matrix.rows; i++) {
                str += matrix.data[i].join(' ') + '<br>';
            }
            return str;
        }

        function vectorToString(vector) {
            if (vector instanceof Vector) {
                return vector.data.join(' ');
            } else if (Array.isArray(vector)) {
                return vector.join(' ');
            } else {
                return vector;
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copiado al portapapeles');
            }).catch(err => {
                console.error('Error al copiar: ', err);
            });
        }

        // Funci√≥n para mostrar secciones
        function showSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            const navBtns = document.querySelectorAll('.nav-btn');
            navBtns.forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            generateMatrixInputs('matrix-a', 3, 3);
            generateMatrixInputs('matrix-b', 3, 3);
            generateVectorInputs('vector-a', 3);
            generateVectorInputs('vector-b', 3);
            generateEquationInputs(3, 3);
        });
    </script>
</body>
</html>
